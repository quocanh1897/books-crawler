services:
  epub-converter:
    build: .
    volumes:
      # Binslib data â€” bundles, database, dictionary, covers, epub cache
      - ../binslib/data:/data/binslib-data
      - ../binslib/public/covers:/data/covers:ro

    environment:
      - COMPRESSED_DIR=/data/binslib-data/compressed
      - DATABASE_PATH=/data/binslib-data/binslib.db
      - COVERS_DIR=/data/covers
      - EPUB_CACHE_DIR=/data/binslib-data/epub
      - ZSTD_DICT_PATH=/data/binslib-data/global.dict

    # Pass through any CLI args:  docker compose run epub-converter --ids 100358
    # Default (no args) converts all eligible books.
    #
    # Examples:
    #   docker compose run --rm epub-converter
    #   docker compose run --rm epub-converter --ids 100358 128390
    #   docker compose run --rm epub-converter --status completed
    #   docker compose run --rm epub-converter --list
    #   docker compose run --rm epub-converter --dry-run
    #   docker compose run --rm epub-converter --force

    # Allocate a TTY so rich progress bars render properly
    tty: true
    stdin_open: true
